{% extends "base_generic.html" %}
{% load static %}
{% load bookmarks_tags %}

{% block content %}

<link rel="stylesheet" href="{% static "bootstrap4-editable/css/bootstrap-editable.css" %}" />
<script src="{% static "/bootstrap4-editable/js/bootstrap-editable.js" %}"></script>

<!-- button type="button" class="btn btn-primary" ... -->
<a class="btn btn-primary btn-sm" role="button" 
  href="{% url 'bookshelf:book-update' books.pk %}">Edit Book Details</a>
<a class="btn btn-secondary btn-sm" role="button" 
  href="{% url 'bookshelf:state-update' books.pk %}">Update Book State</a>

{% if USE_LIBRARYTHING == "1" %}
<a class="btn btn-secondary btn-sm" role="button" 
  title="book details and reviews on LibraryThing"
  href="{% url 'bookshelf:lookup-librarything' pk=books.pk %}"
  >LibraryThing</a>
{% endif %}

{% if USE_ONLEIHE == "1" %}
<!-- currently not working, and no API documentation available -->
<a class="btn btn-secondary btn-sm" role="button" 
  title="search book in Onleihe"
  href="{% url 'bookshelf:lookup-onleihe' pk=books.pk %}"
  >Onleihe</a>
{% endif %}

<h1>{{ books.title }}</h1>

<p class="mb-0"><strong>Author(s):</strong>
{% for author in books.authors.all %}
  <a href="{% url 'bookshelf:author-detail' author.pk %}">{{ author.name }}</a>{% if not forloop.last %}, {% endif %}
{% endfor %}
</p>
<p class="m-0"><strong>ISBN:</strong> 
{% if books.isbn13 %}
  {{ books.isbn13 }}
{% else %}
  {% if books.isbn10 %}
    {{ books.isbn10 }}
  {% else %}
    <i>(ISBN?)</i>
  {% endif %}
{% endif %}
</p>

<p class="m-0">
<strong>Rating:</strong> 
<a href="#" class="userrating" data-name="userRating" data-type="number" 
  data-pk="{{books.id}}" data-url="/bookshelf/books/{{books.id}}/update-userrating/" 
  data-title="rate this book" data-value="{{books.userRating|default:'3'}}">
{% if books.userRating %}
  {{ books.userRating }}
{% else %}
  (no rating)
{% endif %}
</a>
</p>

<br/>
<a href="{% url "bookmarks:bookmark-create" objtype='books' pk=books.id %}">add bookmark</a>

{% show_bookmarks books %}
<br/>

<p><strong>Description:</strong><br/> 
{% if not books.new_description %}
  {% if not books.description %}
      (missing description)
  {% else %}
      {{ books.description|safe|linebreaks }}
  {% endif %}
{% else %}
      {{ books.new_description|safe|linebreaks }}
{% endif %}
</p>
<hr/>
<p class="detail_brief">Updated: {{ books.updated|date:"c" }}</p>
<p class="detail_brief">States: {{ books.states }}</p>
<p class="detail_brief">Onleihe: {{ books.onleihebooks|default:'---' }}</p>

<hr/>

<div style="margin-left:20px;margin-top:20px">
<h4>Comments</h4>

{% if books.comments_set.count %}
<table class="table table-sm booksdetail" id="bookscomments"
    data-toggle="table"
    data-id-field="id"
    data-show-columns="false"
    data-show-toggle="true"
>
<thead>
  <tr>
    <th>Date</th>
    <th>Note</th>
  </tr>
</thead>
<tbody>

{% for comment in books_comments %}
<tr>
<td class="comment-date small">{{ comment.datetime_created }}</td>
<td class="comment-text">{{ comment.clean_text }}</td>
</tr>
{% endfor %}

</tbody>
</table>

{% else %}
    (no notes)
{% endif %}

<br/>
<hr/>
</div>

<script>
// $(document).ready(() => {
console.debug("setup editable for userrating field");
$('.userrating').editable({
  // mode: 'inline',
  type: 'number',
  min: '1',
  max: '5',
  step: '1'
});
</script>

{% endblock %}

